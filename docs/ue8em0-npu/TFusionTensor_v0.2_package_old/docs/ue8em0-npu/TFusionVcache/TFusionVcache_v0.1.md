
# TFusionVcache (TFVcache) Policy v0.1

## 1. ê°œìš” (Overview)

ì¼ë°˜ì ìœ¼ë¡œ **TPU / GPU**ì—ì„œ **AI ëŒ€ê·œëª¨ ì—°ì‚°**ì„ ìˆ˜í–‰í•  ë•ŒëŠ”, **ìˆ˜ì‹­ MB~ìˆ˜ë°± MBê¸‰ KVCache**ê°€ í•„ìš”í•©ë‹ˆë‹¤.  
- ë³´í†µ **32 MB, 64 MB, 128 MB** í˜¹ì€ ê·¸ ì´ìƒì˜ ìºì‹œ ìš©ëŸ‰ì´ ì‚¬ìš©ë˜ë©°,  
- ì´ëŠ” **ëª¨ë¸ í¬ê¸°, ë°°ì¹˜ ì‚¬ì´ì¦ˆ, ì¶”ë¡  ì‹œí€€ìŠ¤ ê¸¸ì´** ë“±ì— ë”°ë¼ ê²°ì •ë©ë‹ˆë‹¤.  

ì´ë²ˆ ì„¤ëª…ì—ì„œëŠ” **ë‹¤ì¤‘ ìºì‹œ ì •ì±…ì„ ë³‘í–‰**í•˜ëŠ” ì‚¬ë¡€ë¥¼ ë³´ì—¬ì£¼ê¸° ìœ„í•´, **64 MB** ë¬¼ë¦¬ ìºì‹œë¥¼ ê¸°ì¤€ìœ¼ë¡œ ì„¤ì •í–ˆìŠµë‹ˆë‹¤.  
ì¦‰, í•˜ë‚˜ì˜ 64 MB ë¬¼ë¦¬ ìºì‹œë¥¼ ë…¼ë¦¬ì ìœ¼ë¡œ **KV-policy**ì™€ **Tensor-policy** ë‘ ê°€ì§€ ì˜ì—­ìœ¼ë¡œ ë‚˜ëˆ„ì–´, ìƒí™©ì— ë”°ë¼ ê°€ë³€ì ìœ¼ë¡œ ìš©ëŸ‰ì„ ìž¬ì¡°ì •í•˜ëŠ” êµ¬ì¡°ë¥¼ **TFusionVcache**ë¼ ë¶€ë¦…ë‹ˆë‹¤.  

---

## 2. ì™œ í•„ìš”í•œê°€? (ë™ê¸°)

### 2-1. ê¸°ì¡´ ê³„ì¸µí˜• ìºì‹œì˜ í•œê³„
CPUì˜ ì „í†µì  ìºì‹œëŠ” L1 â†’ L2 â†’ L3 ì‹ì˜ ê³„ì¸µ êµ¬ì¡°ìž…ë‹ˆë‹¤.  
ê³„ì¸µì´ ê¹Šì–´ì§ˆìˆ˜ë¡ ížˆíŠ¸ìœ¨ì€ ì¢‹ì•„ì§€ì§€ë§Œ, **latencyê°€ ëˆ„ì **ë˜ì–´ GPU/TPU ê°™ì€ ëŒ€ê·œëª¨ ë³‘ë ¬ ì—°ì‚°ì—ëŠ” ë¶ˆë¦¬í•©ë‹ˆë‹¤.  

### 2-2. AI ì›Œí¬ë¡œë“œì˜ íŠ¹ì„±
- **KV-cache** (LLM ë””ì½”ë” ë‹¨ê³„) â†’ ìž‘ì€ í¬ê¸°ì˜ í† í°, ìˆœì°¨ì Â·ìž¬ì‚¬ìš© ë§Žì€ ì ‘ê·¼.  
- **Tensor ì—°ì‚°** (í–‰ë ¬/í•©ì„±ê³±) â†’ í° ë¸”ë¡, ìŠ¤íŠ¸ë¦¬ë° ìœ„ì£¼, 1íšŒì„± ì ‘ê·¼ ë§ŽìŒ.  
- ë™ì¼í•œ ìºì‹œ ì •ì±…ìœ¼ë¡œ ì²˜ë¦¬í•˜ë©´, í•œìª½ì€ ížˆíŠ¸ìœ¨ ë‚®ê³  ë‹¤ë¥¸ ìª½ì€ ë‚­ë¹„ê°€ ë§Žì•„ì§‘ë‹ˆë‹¤.  

ðŸ‘‰ ë”°ë¼ì„œ **ì›Œí¬ë¡œë“œ íŠ¹ì„±ë³„ë¡œ ë§žì¶¤í˜• ì •ì±…ì„ ë³‘í–‰**í•´ì•¼ ì „ì²´ íš¨ìœ¨ì´ ì˜¬ë¼ê°‘ë‹ˆë‹¤.  

---

## 3. TFusionVcache êµ¬ì¡°

- ë¬¼ë¦¬: **64 MB ë‹¨ì¼ ìºì‹œ ë±…í¬(16 banks Ã— 4 MB)**  
- ë…¼ë¦¬: **KV-policy ì˜ì—­**ê³¼ **Tensor-policy ì˜ì—­**  
- ì´ˆê¸°ê°’: 32 MB / 32 MB â†’ ë™ì  ì¡°ì •(ìµœì†Œ 16 MB, ìµœëŒ€ 48 MB)

### Front-End Cache Multiplexor
- ìš”ì²­ì´ ë“¤ì–´ì˜¤ë©´ **Classifier**ê°€ â€œKVì¸ì§€, Tensorì¸ì§€â€ íŒë³„ â†’ ê°ê°ì˜ policy ì—”ì§„ìœ¼ë¡œ ì „ë‹¬  
- ížˆíŠ¸ìœ¨, ë¯¸ìŠ¤íŒ¨ë„í‹°, DRAM í ì ìœ ìœ¨ ë“± Telemetryë¡œ íŒŒí‹°ì…˜ ë¹„ìœ¨ì„ ì‹¤ì‹œê°„ ì¡°ì •  

---

## 4. ì •ì±…ë³„ ì„¸ë¶€ ë™ìž‘

### KV-policy
- ìž‘ì€ ë¼ì¸ í¬ê¸°(64â€“128B)  
- ëŒ€ì²´ ì •ì±…: **SRRIP + pin bit** (í† í° ìœˆë„ëŠ” ë¬´ì¡°ê±´ ìœ ì§€)  
- í”„ë¦¬íŒ¨ì¹˜: â€œë‹¤ìŒ í† í°(+1 step ahead)â€ ë¯¸ë¦¬ ê°€ì ¸ì˜¤ê¸°  
- **ë¹„ìœ **: ì‹œí—˜ê³µë¶€í•  ë•Œ ìžì£¼ ë³´ëŠ” í¬ìŠ¤íŠ¸ìž‡ì€ ì±…ìƒ ìœ„ì— ê³„ì† ë¶™ì—¬ë‘”ë‹¤  

### Tensor-policy
- í° ë¸”ë¡ í¬ê¸°(256â€“512B), ìŠ¤íŠ¸ë¦¼ ë²„í¼ í™œìš©  
- ëŒ€ì²´ ì •ì±…: **NMR/Bypass ìš°ì„ ** (1íšŒì„± ë°ì´í„°ëŠ” ìºì‹œ ì•ˆ í•¨)  
- í”„ë¦¬íŒ¨ì¹˜: íƒ€ì¼ 2ê°œ ì´ìƒ ë¯¸ë¦¬ ì¤€ë¹„  
- **ë¹„ìœ **: ë§ˆíŠ¸ì—ì„œ ëŒ€ìš©ëŸ‰ ìƒìˆ˜ë¥¼ ì¹´íŠ¸ì— ë¯¸ë¦¬ ë‘ì„¸ ë°•ìŠ¤ ìŒ“ì•„ë‘ëŠ” ê²ƒ  

---

## 5. ë™ì  íŒŒí‹°ì…”ë‹

```pseudo
S_k = w1*Hk - w2*MPk - w3*BQk
S_t = w1*Ht - w2*MPt - w3*BQt
Î” = S_k - S_t
if Î” > Î¸ and KV_MB < 48: KV_MB += 4; T_MB -= 4
elif Î” < -Î¸ and T_MB < 48: T_MB += 4; KV_MB -= 4
```
**ì‹¬ë³¼ ì •ì˜(ê°„ëžµ):**
- `S_k` : KV ì˜ì—­ì˜ ì ìˆ˜(í™•ëŒ€ í•„ìš”ì„±ì„ ë‚˜íƒ€ë‚´ëŠ” ì§€í‘œ)
- `S_t` : Tensor ì˜ì—­ì˜ ì ìˆ˜
- `w1`~`w3` : ê°€ì¤‘ì¹˜(0~1 ì‚¬ì´ ê°’ ê¶Œìž¥). `w1`=ížˆíŠ¸ìœ¨ ì¤‘ìš”ë„, `w2`=miss penalty ì¤‘ìš”ë„, `w3`=DRAM í ì ìœ  ì¤‘ìš”ë„
- `Hk`, `Ht` : (0~1) KV/Tensor ížˆíŠ¸ìœ¨
- `MPk`, `MPt` : KV/Tensor miss penalty(í‰ê·  ë¯¸ìŠ¤ ì§€ì—°, ns ë˜ëŠ” ì‚¬ì´í´)
- `BQk`, `BQt` : KV/Tensor ë¯¸ìŠ¤ ì²˜ë¦¬ ì‹œ DRAM í ì ìœ (0~1, í˜¹ì€ %)
- `Î¸` : íŒŒí‹°ì…˜ ë³€ê²½ì„ ìœ ë°œí•˜ëŠ” ìž„ê³„ì¹˜(ížˆìŠ¤í…Œë¦¬ì‹œìŠ¤ìš©)


- Î”ê°€ ì–‘ìˆ˜ â†’ KV ìºì‹œ í™•ëŒ€  
- Î”ê°€ ìŒìˆ˜ â†’ Tensor ìºì‹œ í™•ëŒ€  
- 4 MB ë‹¨ìœ„ step, ì¿¨ë‹¤ìš´ ì£¼ê¸° ìžˆìŒ  

---

## 6. ë„ë©´ (Visualization)

### 6-1. ì •ì±… ê´€ì  (Algorithm view)
![TFusionVcache Policy v0.1](diagrams/TFusionVcache_algorithm_v0_1.svg)

### 6-2. ë°ì´í„° í”Œë¡œìš° ê´€ì 
![TFusionVcache Dataflow v0.1](diagrams/TFusionVcache_dataflow_v0_1.svg)

### 6-3. ìºì‹œ ë¸”ë¡ ë‚´ë¶€
![TFusionVcache Block Internals](diagrams/TFusionVcache_block_algo_v0_1.svg)

### 6-4. ì‹œìŠ¤í…œ ì—°ê³„
![TFusionVcache in System](diagrams/TFusionVcache_system_v0_1.svg)

---

## 7. TCO (Total Cost Optimization) ê´€ì 

- **DRAM/HBM ì „ì†¡**ì„ ì¤„ì—¬ì¤Œ â†’ ì „ì†¡ íšŸìˆ˜ ì¤„ìˆ˜ë¡ ì „ê¸° ìš”ê¸ˆ/TCO ì ˆê°  
- **í´ëŸ­ì„ ë†’ì´ì§€ ì•Šê³ ë„ latency ê°œì„ ** â†’ ë°œì—´/ì¿¨ë§ ë¹„ìš© ì ˆì•½  
- **ê°™ì€ ì¹© ë©´ì ì—ì„œ ë” ë§Žì€ ì„±ëŠ¥ íš¨ìœ¨** â†’ CAPEX ëŒ€ë¹„ ROI í–¥ìƒ  

**ë¹„ìœ **:  
- â€œë§¤ë²ˆ íŽ¸ì˜ì  ê°€ì„œ ë¬¼ ì‚¬ì˜¤ëŠ” ê²ƒ(DRAM)â€ë³´ë‹¤, **ì§‘ ëƒ‰ìž¥ê³ ì— 2ë¦¬í„° ë¬¼ì„ ìŸì—¬ë‘ëŠ” ê²ƒ(Cache)**ì´ í›¨ì”¬ ì‹¸ê³  íŽ¸ë¦¬í•˜ë‹¤.  
- TFusionVcacheëŠ” **ëƒ‰ìž¥ê³  ì•ˆì„ â€˜ìŒë£Œ/ë¬¼â€™ ì¹¸ì²˜ëŸ¼ ë‚˜ëˆ ë‘ê³ **, í•„ìš”ì— ë”°ë¼ ì¹¸ í¬ê¸°ë¥¼ ë°”ê¾¸ëŠ” ìŠ¤ë§ˆíŠ¸ ëƒ‰ìž¥ê³ ì™€ ê°™ë‹¤.  

---

## 8. ê²°ë¡ 

**TFusionVcache**ëŠ”  
- í‰ë©´ì (1-depth) êµ¬ì¡°,  
- ì •ì±…ë³„ ìµœì í™”,  
- ë™ì  íŒŒí‹°ì…˜,  
- QoS ê¸°ë°˜ ìš´ì˜  

ì„ í†µí•´ ê¸°ì¡´ ê³„ì¸µí˜• ìºì‹œë³´ë‹¤ **ë‚®ì€ latency, ë” ë†’ì€ íš¨ìœ¨, ë‚®ì€ TCO**ë¥¼ ë‹¬ì„±í•  ìˆ˜ ìžˆëŠ” ì‹ ê°œë… ìºì‹œìž…ë‹ˆë‹¤.  

ðŸ‘‰ í•™ë¶€ìƒë„ ì´ ì›ë¦¬ë¥¼ ì´í•´í•˜ë©´, GPU/TPUë¿ ì•„ë‹ˆë¼ **ë„¤íŠ¸ì›Œí¬ ë¼ìš°í„°, SSD ì»¨íŠ¸ë¡¤ëŸ¬, IoT ì—£ì§€ ë””ë°”ì´ìŠ¤** ë“± ë‹¤ì–‘í•œ ì‹œìŠ¤í…œì—ë„ ì‘ìš©í•  ìˆ˜ ìžˆìŠµë‹ˆë‹¤.  
